# WEB优化
web优化根据浏览器访问网页的原理，对整条链路进行拆分优化，这涉及到几乎整个前端基础知识体系。网上已经有很多人进行了分享，也有直接给出很多种优化建议的。  
根据之前的优化经验和了解的一些知识，对整个链路优化进行下个人总结，初步分类如下：
1. 网络请求优化
2. 浏览器渲染优化
3. 浏览器js执行优化

## 网络请求优化
网络请求优化又能细分到如下几种：
1. 网络优化
2. 资源、数据加载的优化
3. 缓存（避免无意义请求）
4. 服务器响应优化

### 网络优化
网络优化主要是从路由和DNS还有请求协议等多方面偏网络本身进行优化的。前端这里虽然从代码层面做不了多少东西，主要还是前端运维、运维开发的工作，但是前端需要知道这个过程究竟能做些什么，来优化自己的前端应用。

#### DNS优化
原理：浏览器发起页面请求的时候，是通过域名来访问页面的。而通过域名来找到服务器所在的真实网络IP地址，就是DNS解析过程。  
可以通过```nslookup```或者```dig +trace``` 命令来看整个过程
1. 浏览器先读取自己最近访问、访问频繁的`域名-IP`的缓存，快速查找是否有记录直接进行访问
2. 从本机的hosts配置中读取是否已经有静态配置好的`域名-IP`配置
3. 通过本机配置的DNS服务器，一般在电脑的网络适配器配置，通过DNS服务器查找`域名-IP`
4. 没有本机配置的DNS服务器的话，会去网络运营商的DNS服务器中查找`域名-IP`
5. 最后的兜底DNS解析，即从一级域名下，找二级域名，再三级。。。直到找到为止

这个过程中，1和2比较难控制，毕竟那是用户本身本地环境，无法通过人工进行干涉。3～5，都可以进行一定的干涉。比如3，对常见的DNS服务器，如8.8.8.8，114.114.114.114等等这种，保证常用DNS服务器、运营商DNS服务器等均有收录自己网站域名的解析。深入的可以去搜索下`DNS优化`还能看到一些防劫持等等DNS的有趣东西。

#### 访问网络链路优化
原理：举个🌰，如果你从山东烟台要去辽宁大连，开车的话，都知道，需要通过省道、高速来来回回，绕一个c形。大家都知道两点的具体位置（IP地址），但是外在条件（网络线路）就是不能让你两点之间直线最短的方式直接过去。你必须耗很长时间才能到达（网页加载很慢，理论上不考虑近道的情况下，距离服务器越远的地方，耗时也会更长）。因此，这时候就有服务商出来了，说建立了一个从A枢纽直达B枢纽的网络通道，可能枢纽并不在你的目的地，只是在目的地附近，但是，如果真的能大大减少你的路程长度的情况下。

这里需要购买有加速网络服务，通常服务商们会有成套的加速优化方案，不需要个人去找哪条网络会更快。
当然CDN这个词应该都不陌生，个人是把它归类在这里，也是网络链路的优化。当然它的作用不止这个，还有缓存（后续会在缓存也会说）等其他的功能。

#### 异地多“活”
原理：既然用户离服务器比较远，那我在你用户多的地方，直接搭一个服务器不久好了。当然异地多活的实际作用不仅仅是这些，还有很多好处，比如故障容灾、数据备份而且可用，流量调度负载均衡等等等等。。

### 资源加载的优化
网页请求过程中，会有很多数据和资源需要加载。其中静态资源的请求过程，如html、css、js、图片等等，都可以进行一定程度的优化。

#### 应用协议
可以详细搜索看一下`应用层协议HTTP1.0、HTTP1.1，HTTP2和HTTP3的优化`。

---

> 减少请求次数和减小请求大小在某些必要的场景下，是相互斥的，因此在必要的时候需衡量这两个方式，以达到最好的结果。  

#### 减少请求次数
因为浏览器对网页的并发请求数目都会有一定限制，不考虑资源大小来说，资源个数越多，即页面加载的内容越多，页面加载的速度就越慢，因此就需要减少请求次数。这里常见的优化方案有：
1. 对资源进行合并，如js的bundle、css的合并，雪碧图等
2. 静态资源数据化，如icon图等较小资源转base64加载等
3. 按需加载，如按需加载js、图片等资源的懒加载等

#### 减小请求大小
当请求次数固定下来无法减少后，对请求、请求返回内容的大小也是影响整个网页加载的重要因素。其次，如果一味的强调减少请求次数，出现例如资源合并，结果合并的单个资源文件很大，而不加载完这个文件，其他操作都没法继续下去，这种场景，一味的减少请求个数就很鸡肋，拆分多个请求包后充分利用并发加载资源能够反而更好。常见的优化方案有：
1. 服务器级的整体压缩，如gzip
2. 对资源本身进行压缩，如图片压缩、js css压缩
3. 去除无用代码，如tree shaking
4. 按需加载，而不是直接引入一个完整包然后使用其中极少的某一部分
5. 接口数据，去除无用的数据

### 缓存（避免无意义请求）
对页面的资源、接口数据只要在保证失效性的前提下，都可以进行缓存，避免多次重复加载同一个资源、同一数据。如果需要了解页面资源缓存，网上有很多优质的文章去专门总结的，这里不做扩展，只是介绍方式。常见的缓存形式有：
1. 强缓存
2. 协商缓存
3. 接口数据缓存
4. 静态数据缓存
5. CDN缓存

### 服务器响应优化
当请求已经到达服务器后，战场就转移到了服务器这边。主要能做的就两点：
1. 快速处理请求，对于已经到达服务器的请求，因为服务器是面向所有用户的，会有很多
2. 快速响应请求，

## 浏览器渲染优化


## 浏览器js执行优化
在考虑浏览器js执行期间的优化，是因为js执行是单线程的。如果一个地方执行耗费时间过长，会导致后续的所有操作排队等待，页面出现卡顿、无法操作，造成很差的使用体验。这个可以通过团队js代码规范、code review、使用一些声望较高的框架架构等等，都能够一定程度上避免一些基本问题。从源码上来说：  

1. 尽量减少dom操作，如果需要大量操作，尽量批量处理
2. 尽量减少计算复杂程度度或在把不需要dom操作的场景使用web worker
3. 尽量拆分微任务使用```requestIdleCallback```处理dom更新，避免出现更新dom期间无法及时处理其他异步操作，如事件等
4. 其他。。


## 总结
前端的优化，虽然在这里总结了常见的这些优化方案，但也只是基于最基本级别的，进行整个流程的所有路段进行优化。😂对于实际项目，可不是这种“赤条条”的人（一个页面），而是一层层包装后的高达（一个应用），或者说是层层叠加后的怪物。比如，前台页面里的埋点、统计，错误上报，接口请求的各种转发、聚合，请求链路追踪，错误页面友好，各种2d、3d动画效果提升用户体验，超大数据集的数据展示，网络安全的各种解决方案如自定义请求头、数据加密等等等等，针对具体的业务场景，还有很多很多需要针对性的优化。👋，发际线～